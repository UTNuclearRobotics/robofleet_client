#pragma once

// the plugin parent class
#include <robofleet_client/ROSMsgHandlers.hpp>

// get the msg type
#include <{msg_package}/{msg_name}.h>

#include <{msg_package}_robofleet/schema_generated.h>

namespace {msg_package}_robofleet {{

  class {msg_name}PublishHandler : public robofleet_client::ROSPublishHandler
  {{
  public:
    virtual void initialize(ros::NodeHandle& nh,
                            const std::string to_topic,
                            const bool latched);
                    
    virtual void publish(const QByteArray& data);
    
  private:
    typedef {msg_package}::{msg_name} MsgType;

    MsgType decode(const QByteArray& data);
  }};
  
  
  
  class {msg_name}SubscribeHandler : public robofleet_client::ROSSubscribeHandler
  {{
  public:
    virtual bool initialize(ros::NodeHandle& nh,
                              MessageScheduler* scheduler,
                              const std::string to_topic,
                              const double priority,
                              const double rate_limit,
                              const bool no_drop);
    
  private:
    typedef {msg_package}::{msg_name} MsgType;
    typedef boost::shared_ptr<MsgType> MsgTypeConstPtr;
    typedef flatbuffers::Offset<fb::MsgMetadata> MetaDataOffset;
    
    std::function<MetaDataOffset(flatbuffers::FlatBufferBuilder&)> encode_metadata_function_;
    
    QByteArray encode(const MsgType& msg);
    
    void callback(const MsgTypeConstPtr& msg);
  }};
}}